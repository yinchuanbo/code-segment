---
date: 2024-06-16T14:04:45+08:00
title: "Proxy ä¸ Reflect"
---

**å¼•è¨€ï¼š** åœ¨ JavaScript çš„ä¸–ç•Œé‡Œï¼Œ`Proxy`Â  å’Œ Â `Reflect`Â  å¦‚åŒè™è ä¾ ä¸ç½—å®¾ï¼Œæ€»æ˜¯å¹¶è‚©ä½œæˆ˜ã€‚ä½†ä½ æ˜¯å¦æƒ³è¿‡ï¼Œä¸ºä»€ä¹ˆæ¯ä¸ªå‰ç«¯å¼€å‘è€…åœ¨ä½¿ç”¨ Proxy æ—¶éƒ½åº”æŒæ¡ Reflectï¼ŸProxy çœŸçš„ä¸å¤Ÿå¼ºå¤§ï¼Œéœ€è¦ Reflect æ¥åŠ©åŠ›å—ï¼Ÿ

## Proxy çš„åŠ›é‡

`Proxy`Â  å¯¹è±¡æ˜¯ JavaScript ä¸­çš„ä¸€é¡¹å¼ºå¤§ç‰¹æ€§ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä¸ºä»»ä½•ç›®æ ‡å¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†ï¼Œä»è€Œæ‹¦æˆªå’Œå®šä¹‰å¯¹è¯¥å¯¹è±¡çš„åŸºæœ¬æ“ä½œçš„è‡ªå®šä¹‰è¡Œä¸ºã€‚è¿™åŒ…æ‹¬å±æ€§æŸ¥æ‰¾ã€èµ‹å€¼ã€æšä¸¾ã€å‡½æ•°è°ƒç”¨ç­‰ã€‚é€šè¿‡ä»£ç†ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨æ§åˆ¶å¯¹å†…éƒ¨å¯¹è±¡çš„è®¿é—®ï¼Œå¹¶å¯ä»¥æŒ‰ç…§éœ€è¦è‡ªå®šä¹‰è¡Œä¸ºã€‚

åŸºæœ¬è¯­æ³•

```js
const proxy = new Proxy(target, handler);
```

- `target`ï¼šç›®æ ‡å¯¹è±¡ï¼Œå³è¢«ä»£ç†çš„å¯¹è±¡ã€‚
- `handler`ï¼šå¤„ç†ç¨‹åºå¯¹è±¡ï¼Œå®šä¹‰äº†ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œç”¨äºæ‹¦æˆªå’Œå®šä¹‰ç›®æ ‡å¯¹è±¡çš„æ“ä½œã€‚

æˆ‘ä»¬çœ‹ä¸€ä¸ªå®ä¾‹ä»£ç ï¼š

```js
const target = { name: "å°æ˜", age: 18 };

const handler = {
  get(target, prop, receiver) {
    console.log(`è®¿é—®äº†å±æ€§ï¼š${prop}`);
    return target[prop];
  },
  set(target, prop, value, receiver) {
    console.log(`è®¾ç½®äº†å±æ€§ï¼š${prop}ï¼Œå€¼ä¸ºï¼š${value}`);
    target[prop] = value;
    return true;
  },
};

const proxy = new Proxy(target, handler);

console.log(proxy.name); // è¾“å‡ºï¼šè®¿é—®äº†å±æ€§ï¼šnameï¼Œå°æ˜
proxy.age = 19; // è¾“å‡ºï¼šè®¾ç½®äº†å±æ€§ï¼šageï¼Œå€¼ä¸ºï¼š19
console.log(proxy.age); // è¾“å‡ºï¼šè®¿é—®äº†å±æ€§ï¼šageï¼Œ19
```

è¿™é‡Œæˆ‘ä»¬é€šè¿‡åˆ›å»ºäº†ä¸€ä¸ª `Proxy`ï¼ŒæˆåŠŸæ‹¦æˆªäº†`target`å±æ€§çš„è®¿é—®å’Œèµ‹å€¼æ“ä½œï¼Œå¹¶åœ¨è¿™äº›æ“ä½œå‘ç”Ÿæ—¶æ‰“å° console å‡ºç›¸åº”çš„ä¿¡æ¯ã€‚

## Reflect çš„å‡ºç°ä¸ä½œç”¨

`Reflect` æ˜¯ä¸€ä¸ªå†…ç½®å¯¹è±¡ï¼Œå®ƒæä¾›äº†ä¸€ç»„ä¸ JavaScript è¿è¡Œæ—¶æ“ä½œå¯¹åº”çš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•ä½¿å¾—åœ¨ç¼–å†™ä»£ç†å¤„ç†ç¨‹åºæ—¶ï¼Œå¯ä»¥è½»æ¾åœ°è°ƒç”¨å¯¹è±¡çš„é»˜è®¤è¡Œä¸ºã€‚

ä»¥ä¸‹æ˜¯ `Reflect` çš„åŸºæœ¬è¯­æ³•å’Œç¤ºä¾‹ï¼š

```js
// å®šä¹‰ç›®æ ‡å¯¹è±¡
const target = { name: "å°æ˜", age: 18 };

// ä½¿ç”¨ Reflect.get() æ¥è·å–å±æ€§å€¼
const name = Reflect.get(target, "name");
console.log(name); // è¾“å‡ºï¼šå°æ˜

// ä½¿ç”¨ Reflect.set() æ¥è®¾ç½®å±æ€§å€¼
Reflect.set(target, "age", 19);
console.log(target.age); // è¾“å‡ºï¼š19

// ä½¿ç”¨ Reflect.has() æ¥æ£€æŸ¥å±æ€§æ˜¯å¦å­˜åœ¨
const hasAge = Reflect.has(target, "age");
console.log(hasAge); // è¾“å‡ºï¼štrue

// ä½¿ç”¨ Reflect.deleteProperty() æ¥åˆ é™¤å±æ€§
Reflect.deleteProperty(target, "name");
console.log(target.name); // è¾“å‡ºï¼šundefined

// ä½¿ç”¨ Reflect.ownKeys() æ¥è·å–å¯¹è±¡çš„æ‰€æœ‰è‡ªæœ‰å±æ€§çš„é”®
const keys = Reflect.ownKeys(target);
console.log(keys); // è¾“å‡ºï¼š['age']
```

`Reflect` çš„æ–¹æ³•ä¸ JS è¯­è¨€å†…éƒ¨çš„æ“ä½œç´§å¯†å¯¹åº”ï¼Œä½¿å¾—åœ¨ç¼–å†™ä»£ç†å¤„ç†ç¨‹åºæ—¶èƒ½å¤Ÿè½»æ¾åœ°è°ƒç”¨åŸå§‹æ“ä½œã€‚

## ä¸ºä»€ä¹ˆéœ€è¦ Reflect å‘¢ï¼ŸğŸ§ğŸ§ğŸ§

### Proxy çš„å±€é™æ€§

JavaScript ä¸­çš„ `Proxy` æä¾›äº†ä¸€ç§å¼ºå¤§ä¸”çµæ´»çš„æ–¹å¼æ¥æ‹¦æˆªå¹¶å®šä¹‰å¯¹è±¡çš„åŸºæœ¬æ“ä½œçš„è‡ªå®šä¹‰è¡Œä¸ºã€‚ç„¶è€Œï¼Œå•ç‹¬ä½¿ç”¨ `Proxy` åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šé‡åˆ°ä¸€äº›å±€é™æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨å°è¯•æ¨¡ä»¿é»˜è®¤è¡Œä¸ºæ—¶ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨æ‹¦æˆªå±æ€§çš„è¯»å–æ“ä½œæ—¶ï¼Œä»ç„¶è¿”å›å±æ€§çš„é»˜è®¤å€¼ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨å¤„ç†ç¨‹åºä¸­å®ç°è¿™ä¸€ç‚¹ï¼š

```js
const target = { name: "å°æ˜", age: 18 };

const handler = {
  get(target, prop, receiver) {
    if (prop in target) {
      return target[prop]; // æ‰‹åŠ¨æ¨¡ä»¿é»˜è®¤çš„ get è¡Œä¸º
    }
    return undefined; // å¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œè¿”å› undefined
  },
  set(target, prop, value, receiver) {
    if (prop === "age" && typeof value !== "number") {
      throw new TypeError("Age must be a number");
    }
    // æ‰‹åŠ¨å®ç°é»˜è®¤è¡Œä¸º
    target[prop] = value;
    return true;
  },
};

const proxy = new Proxy(target, handler);
console.log(proxy.name); // è¾“å‡ºï¼šå°æ˜
```

è¿™ç§æ–¹å¼è™½ç„¶å¯è¡Œï¼Œä½†ä¸å¤Ÿä¼˜é›…ï¼Œå› ä¸ºå®ƒè¦æ±‚å¼€å‘è€…æ‰‹åŠ¨å®ç°è¯­è¨€çš„é»˜è®¤è¡Œä¸ºï¼Œå¹¶ä¸”å®¹æ˜“å‡ºé”™ã€‚

### Reflect çš„ä¼˜åŠ¿

é€šè¿‡ä½¿ç”¨ `Reflect`ï¼Œæˆ‘ä»¬å¯ä»¥æ›´ä¼˜é›…åœ°å®ç°ä¸Šè¿°è¡Œä¸ºï¼š

```js
const target = { name: "å°æ˜", age: 18 };

const handler = {
  get(target, prop, receiver) {
    // ä½¿ç”¨ Reflect æ¨¡ä»¿é»˜è®¤çš„ get è¡Œä¸ºï¼Œå¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œè¿”å› undefined
    return Reflect.get(target, prop, receiver);
  },
  set(target, prop, value, receiver) {
    // ä½¿ç”¨ Reflect.set() è°ƒç”¨é»˜è®¤è¡Œä¸ºï¼ŒæˆåŠŸè¿”å› true
    return Reflect.set(target, prop, value, receiver);
  },
};

const proxy = new Proxy(target, handler);
console.log(proxy.name); // è¾“å‡ºï¼šå°æ˜
```

è¿™æ ·ä»£ç æ›´ç®€æ´ï¼Œè¡Œä¸ºä¹Ÿæ›´ä¸€è‡´ã€‚

### Reflect çš„å¿…è¦æ€§

1. **é»˜è®¤è¡Œä¸ºçš„ä¸€è‡´æ€§**ï¼š`Reflect` å¯¹è±¡æä¾›äº†ä¸å¤§å¤šæ•° `Proxy` traps å¯¹åº”çš„æ–¹æ³•ï¼Œä½¿å¾—åœ¨è¿›è¡Œå¯¹è±¡æ“ä½œæ—¶ï¼Œå¯ä»¥ä¿æŒä¸€è‡´çš„ç¼–ç¨‹æ¨¡å¼ï¼Œä¸”ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§æ›´å¼ºã€‚
2. **æ›´å¥½çš„é”™è¯¯å¤„ç†**ï¼š`Reflect` æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¯ä»¥æ¸…æ™°åœ°æŒ‡ç¤ºæ“ä½œæ˜¯å¦æˆåŠŸï¼Œè¿™ä½¿å¾—é”™è¯¯å¤„ç†æ›´åŠ ç›´è§‚ã€‚
3. **å‡½æ•°å¼ç¼–ç¨‹é£æ ¼**ï¼š`Reflect` æ–¹æ³•æ¥å—ç›®æ ‡å¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿™å…è®¸ä½ ä»¥å‡½æ•°å¼ç¼–ç¨‹é£æ ¼å¤„ç†å¯¹è±¡æ“ä½œã€‚
4. **æ¥æ”¶è€…ï¼ˆreceiverï¼‰å‚æ•°**ï¼š`Reflect` æ–¹æ³•é€šå¸¸æ¥å—ä¸€ä¸ªæ¥æ”¶è€…å‚æ•°ï¼Œè¿™å…è®¸ä½ åœ¨è°ƒç”¨æ–¹æ³•æ—¶æ˜ç¡®æŒ‡å®š `this` çš„å€¼ï¼Œè¿™åœ¨å®ç°åŸºäºåŸå‹çš„ç»§æ‰¿å’Œè‡ªå®šä¹‰ `this` ç»‘å®šæ—¶éå¸¸æœ‰ç”¨ã€‚

## Proxy ä¸ Reflect çš„ç»“åˆ

é€šè¿‡ `Proxy` å’Œ `Reflect` çš„ç»“åˆï¼Œå¯ä»¥æ›´ç®€æ´åœ°å®ç°å¯¹è±¡çš„ä»£ç†å’Œæ‹¦æˆªæ“ä½œã€‚ä¾‹å¦‚ï¼š

```js
const target = { name: "å°è–‡", age: 17 };

const handler = {
  get(target, prop, receiver) {
    return Reflect.get(target, prop, receiver);
  },
  set(target, prop, value, receiver) {
    return Reflect.set(target, prop, value, receiver);
  },
  has(target, prop) {
    return Reflect.has(target, prop);
  },
  ownKeys(target) {
    return Reflect.ownKeys(target);
  },
};

const proxy = new Proxy(target, handler);
console.log(proxy.name); // è¾“å‡ºï¼šå°è–‡
proxy.age = 18;
console.log(proxy.age); // è¾“å‡ºï¼š18
console.log(Object.keys(proxy)); // è¾“å‡ºï¼š['name', 'age']
```

é€šè¿‡è¿™ç§ç»“åˆï¼Œä»£ç æ›´åŠ ç®€æ´ä¸”æ˜“äºç»´æŠ¤ã€‚

## ä¸åŒåº”ç”¨åœºæ™¯ï¼ˆğŸ”¥ å¯ä»¥å¤åˆ¶ï¼Œç›´æ¥æ‹¿æ¥ä½¿ç”¨ï¼‰

é€šè¿‡ä½¿ç”¨ `Proxy`ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å®ç°å¯¹è±¡çš„ä»£ç†å’Œæ‹¦æˆªæ“ä½œã€‚è€Œ `Reflect` çš„å¼•å…¥ä¸ºä¸è¯­è¨€é»˜è®¤è¡Œä¸ºçš„äº¤äº’æä¾›äº†æ–¹ä¾¿ï¼Œä½¿å¾—ç¼–å†™æ›´å¥å£®å’Œå¯ç»´æŠ¤çš„ä»£ç æˆä¸ºå¯èƒ½ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›å…·ä½“çš„åº”ç”¨åœºæ™¯ï¼š

### æ•°æ®ç»‘å®šä¸è§‚å¯Ÿè€…æ¨¡å¼

åœ¨æ¡†æ¶å¦‚ Vue.js ä¸­ï¼Œ`Proxy` å’Œ `Reflect` å¯ç”¨äºå®ç°æ•°æ®ç»‘å®šå’Œè§‚å¯Ÿè€…æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œç›‘å¬å¯¹è±¡çš„å±æ€§å˜åŒ–å¹¶è§¦å‘ç›¸åº”çš„æ›´æ–°ï¼š

```js
const handler = {
  set(target, prop, value) {
    console.log(`å±æ€§ ${prop} è¢«è®¾ç½®ä¸º ${value}`);
    return Reflect.set(target, prop, value);
  },
};

const data = new Proxy({}, handler);

data.name = "å°æ˜"; // è¾“å‡ºï¼šå±æ€§ name è¢«è®¾ç½®ä¸º å°æ˜
```

### è¡¨å•éªŒè¯

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `Proxy` å’Œ `Reflect` å®ç°è¡¨å•éªŒè¯ï¼Œåœ¨è®¾ç½®å¯¹è±¡å±æ€§æ—¶è¿›è¡Œæ ¡éªŒï¼š

```js
const form = { username: "", age: 0 };

const handler = {
  set(target, prop, value, receiver) {
    if (prop === "age" && (typeof value !== "number" || value <= 0)) {
      throw new TypeError("Age must be a positive number");
    }
    return Reflect.set(target, prop, value, receiver);
  },
};

const proxy = new Proxy(form, handler);

try {
  proxy.age = -5; // æŠ›å‡ºé”™è¯¯ï¼šAge must be a positive number
} catch (e) {
  console.error(e.message);
}

proxy.age = 30; // è®¾ç½®æˆåŠŸ
console.log(proxy.age); // è¾“å‡ºï¼š30
```

### æ‰©å±•å¯¹è±¡åŠŸèƒ½

ä½¿ç”¨ `Proxy` å¯ä»¥åŠ¨æ€åœ°æ‰©å±•å¯¹è±¡åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ç°æœ‰å¯¹è±¡ä¸Šæ·»åŠ æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹å¯¹è±¡çš„åŸå§‹ä»£ç ã€‚

```js
const original = {
  greet() {
    console.log("Hello!");
  },
};

const handler = {
  apply(target, thisArg, argumentsList) {
    console.log(`è°ƒç”¨äº†æ–¹æ³•ï¼š${target.name}`);
    return Reflect.apply(target, thisArg, argumentsList);
  },
};

const proxy = new Proxy(original.greet, handler);

proxy(); // è¾“å‡ºï¼šè°ƒç”¨äº†æ–¹æ³•ï¼šgreetï¼ŒHello!
```

### æ–¹æ³•åŠ«æŒ

æ–¹æ³•åŠ«æŒå¯ä»¥ç”¨äºè°ƒè¯•ã€æ€§èƒ½ç›‘æ§æˆ–æƒé™æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œåœ¨è°ƒç”¨æŸä¸ªæ–¹æ³•å‰åæ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚

```js
const service = {
  fetchData() {
    console.log("Fetching data...");
    // æ¨¡æ‹Ÿæ•°æ®è·å–
  },
};

const handler = {
  apply(target, thisArg, argumentsList) {
    console.log("å¼€å§‹è°ƒç”¨ fetchData");
    const result = Reflect.apply(target, thisArg, argumentsList);
    console.log("ç»“æŸè°ƒç”¨ fetchData");
    return result;
  },
};

const proxy = new Proxy(service.fetchData, handler);

proxy(); // è¾“å‡ºï¼šå¼€å§‹è°ƒç”¨ fetchDataï¼ŒFetching data...ï¼Œç»“æŸè°ƒç”¨ fetchData
```

### API è¯·æ±‚æ‹¦æˆª

æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ `Proxy` å’Œ `Reflect` å®ç° API è¯·æ±‚çš„æ‹¦æˆªå’Œæ—¥å¿—è®°å½•ï¼š

```js
const api = {
  fetchData(endpoint) {
    console.log(`Fetching data from ${endpoint}`);
    // æ¨¡æ‹Ÿ API è¯·æ±‚
    return { data: "Sample Data" };
  },
};

const handler = {
  apply(target, thisArg, argumentsList) {
    console.log(`è°ƒç”¨äº†æ–¹æ³•ï¼š${target.name}`);
    return Reflect.apply(target, thisArg, argumentsList);
  },
};

const proxy = new Proxy(api.fetchData, handler);

const data = proxy("/api/data"); // è¾“å‡ºï¼šè°ƒç”¨äº†æ–¹æ³•ï¼šfetchData Fetching data from /api/data
console.log(data); // è¾“å‡ºï¼š{ data: 'Sample Data' }
```

é€šè¿‡è¿™äº›åº”ç”¨åœºæ™¯çš„å±•ç¤ºï¼Œå¯ä»¥çœ‹å‡º `Proxy` å’Œ `Reflect` åœ¨å®é™…å¼€å‘ä¸­å…·æœ‰å¹¿æ³›çš„åº”ç”¨å‰æ™¯å’Œå¼ºå¤§çš„çµæ´»æ€§ã€‚

## æ€§èƒ½å¯¹æ¯”ï¼ˆğŸ”¥ ä¹Ÿå¾ˆé‡è¦ï¼‰

ä½¿ç”¨ `Proxy` å’Œ `Reflect` çš„æ€§èƒ½å¼€é”€é€šå¸¸è¾ƒå°ï¼Œä½†åœ¨é«˜é¢‘æ¬¡æ“ä½œä¸­å¯èƒ½ä¼šç§¯ç´¯ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ `Proxy` å’Œ `Reflect` çš„æ€§èƒ½æµ‹è¯•ä»£ç ï¼š

```js
const target = { value: 42 };
const handler = {
  get(target, prop, receiver) {
    return Reflect.get(target, prop, receiver);
  },
};

const proxy = new Proxy(target, handler);

console.time("Proxy");
for (let i = 0; i < 1000000; i++) {
  proxy.value;
}
console.timeEnd("Proxy"); // 48.790771484375 ms

console.time("Direct");
for (let i = 0; i < 1000000; i++) {
  target.value;
}
console.timeEnd("Direct"); // 1.714111328125 ms
```

åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œ`Proxy` å’Œ `Reflect` çš„æ€§èƒ½è¶³ä»¥æ»¡è¶³éœ€æ±‚ï¼Œä½†åœ¨æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ä¸­ï¼Œä»éœ€è°¨æ…ä½¿ç”¨ã€‚

## æ€»ç»“

`Proxy` ç”¨äºåˆ›å»ºå¯¹è±¡çš„ä»£ç†ï¼Œå¯ä»¥æ‹¦æˆªå’Œè‡ªå®šä¹‰å¯¹å¯¹è±¡çš„æ“ä½œã€‚`Reflect`æä¾›äº†ä¸€ç»„ä¸ JavaScript è¯­è¨€å†…éƒ¨æ“ä½œç›¸å¯¹åº”çš„æ–¹æ³•ï¼Œæ–¹ä¾¿å¼€å‘è€…æ›´æ ‡å‡†å’Œç®€æ´åœ°æ“ä½œå¯¹è±¡ã€‚é€šè¿‡ç»“åˆ `Proxy` å’Œ `Reflect`ï¼Œå¯ä»¥ç¼–å†™å‡ºæ›´ç®€æ´ã€æ˜“ç»´æŠ¤çš„ä»£ç ã€‚
